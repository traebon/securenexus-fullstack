# CoreDNS Configuration as Authoritative DNS Server

# Authoritative zone for securenexus.net
securenexus.net:53 {
    # Enable for all clients (public DNS server)
    # No ACL restrictions for authoritative queries

    # Health check endpoint
    health :8080

    # Prometheus metrics
    prometheus :9153

    # Error and access logging
    errors
    log

    # etcd backend for zone data
    etcd {
        path /coredns
        endpoint http://etcd:2379
        # Remove upstream for authoritative responses
    }

    # TODO(human): Add file plugin for NS records
    file /etc/coredns/zones/securenexus.net.zone

    # Cache authoritative responses
    cache 300 {
        success 9984 300
        denial 9984 300
    }

    # Load balancing for multiple records
    loadbalance round_robin
}

# Authoritative zone for byrne-accounts.org
byrne-accounts.org:53 {
    # Enable for all clients (public DNS server)
    # No ACL restrictions for authoritative queries

    # Health check endpoint
    health :8080

    # Prometheus metrics
    prometheus :9153

    # Error and access logging
    errors
    log

    # File backend for zone data
    file /etc/coredns/zones/byrne-accounts.org.zone

    # Cache authoritative responses
    cache 300 {
        success 9984 300
        denial 9984 300
    }

    # Load balancing for multiple records
    loadbalance round_robin
}

# Authoritative zone for dickson-supplies.com
dickson-supplies.com:53 {
    # Enable for all clients (public DNS server)
    # No ACL restrictions for authoritative queries

    # Health check endpoint
    health :8080

    # Prometheus metrics
    prometheus :9153

    # Error and access logging
    errors
    log

    # File backend for zone data
    file /etc/coredns/zones/dickson-supplies.com.zone

    # Cache authoritative responses
    cache 300 {
        success 9984 300
        denial 9984 300
    }

    # Load balancing for multiple records
    loadbalance round_robin
}

# Authoritative zone for evilrabbitart.com
evilrabbitart.com:53 {
    # Enable for all clients (public DNS server)
    # No ACL restrictions for authoritative queries

    # Health check endpoint
    health :8080

    # Prometheus metrics
    prometheus :9153

    # Error and access logging
    errors
    log

    # File backend for zone data
    file /etc/coredns/zones/evilrabbitart.com.zone

    # Cache authoritative responses
    cache 300 {
        success 9984 300
        denial 9984 300
    }

    # Load balancing for multiple records
    loadbalance round_robin
}

# Catch-all for other domains (recursive resolver)
.:53 {
    # Allow all networks for public DNS service
    acl {
        allow net 0.0.0.0/0
        allow net ::/0
    }

    # Health check endpoint
    health :8080

    # Prometheus metrics
    prometheus :9153

    # Error and access logging
    errors
    log

    # Cache for recursive queries
    cache 30 {
        success 9984 30
        denial 9983 30
    }

    # Load balancing
    loadbalance round_robin

    # Forward all other queries to upstream DNS
    forward . 8.8.8.8 1.1.1.1 {
        max_concurrent 1000
    }

    # Loop detection
    loop

    # Reload config on changes
    reload 30s

    # Ready endpoint
    ready
}
