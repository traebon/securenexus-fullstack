{
  "title": "SecureNexus - CoreDNS Overview",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "30s",
  "time": {"from": "now-1h", "to": "now"},
  "panels": [
    {
      "type": "stat",
      "title": "DNS Query Rate",
      "datasource": {"type": "prometheus", "uid": "Prometheus"},
      "targets": [
        {
          "expr": "sum(rate(coredns_dns_requests_total[5m]))",
          "legendFormat": "Queries/sec",
          "refId": "A"
        }
      ],
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 100},
              {"color": "red", "value": 1000}
            ]
          }
        }
      }
    },
    {
      "type": "stat",
      "title": "Response Codes",
      "datasource": {"type": "prometheus", "uid": "Prometheus"},
      "targets": [
        {
          "expr": "sum by (rcode) (rate(coredns_dns_responses_total[5m]))",
          "legendFormat": "{{rcode}}",
          "refId": "A"
        }
      ],
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0}
    },
    {
      "type": "stat",
      "title": "Cache Hit Rate",
      "datasource": {"type": "prometheus", "uid": "Prometheus"},
      "targets": [
        {
          "expr": "sum(rate(coredns_cache_hits_total[5m])) / sum(rate(coredns_cache_requests_total[5m])) * 100",
          "legendFormat": "Hit Rate %",
          "refId": "A"
        }
      ],
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "max": 100,
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 50},
              {"color": "green", "value": 80}
            ]
          }
        }
      }
    },
    {
      "type": "stat",
      "title": "External Queries",
      "datasource": {"type": "prometheus", "uid": "Prometheus"},
      "targets": [
        {
          "expr": "sum(rate(coredns_dns_requests_total{zone=\"securenexus.net.\"}[5m]))",
          "legendFormat": "External Queries/sec",
          "refId": "A"
        }
      ],
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "blue", "value": null},
              {"color": "green", "value": 1},
              {"color": "yellow", "value": 10}
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "DNS Queries by Type",
      "datasource": {"type": "prometheus", "uid": "Prometheus"},
      "targets": [
        {
          "expr": "sum by (type) (rate(coredns_dns_requests_total[5m]))",
          "legendFormat": "{{type}}",
          "refId": "A"
        }
      ],
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4}
    },
    {
      "type": "timeseries",
      "title": "Response Codes Over Time",
      "datasource": {"type": "prometheus", "uid": "Prometheus"},
      "targets": [
        {
          "expr": "sum by (rcode) (rate(coredns_dns_responses_total[5m]))",
          "legendFormat": "{{rcode}}",
          "refId": "A"
        }
      ],
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4}
    },
    {
      "type": "timeseries",
      "title": "DNS Propagation Tracking (securenexus.net)",
      "datasource": {"type": "prometheus", "uid": "Prometheus"},
      "targets": [
        {
          "expr": "sum by (instance) (probe_success{job=\"blackbox-dns\"})",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ],
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12},
      "alert": {
        "conditions": [
          {
            "query": {"queryType": "", "refId": "A"},
            "reducer": {"params": [], "type": "last"},
            "evaluator": {"params": [0.8], "type": "gt"}
          }
        ],
        "executionErrorState": "alerting",
        "for": "5m",
        "frequency": "10s",
        "handler": 1,
        "name": "DNS Propagation Success",
        "noDataState": "no_data",
        "notifications": []
      }
    }
  ]
}