{
  auto_https off
}

:80 {
  handle /.well-known/security.txt {
    header Content-Type "text/plain"
    respond `Contact: mailto:security@${DOMAIN}
Policy: https://security.${DOMAIN}/policy
Preferred-Languages: en` 200
  }

  handle /.well-known/webfinger {
    header Content-Type "application/jrd+json"
    # Tailscale custom domain discovery
    @tailscale query resource=acct:tristian@securenexus.net
    respond @tailscale `{"subject": "acct:tristian@securenexus.net", "links": [{"rel": "http://openid.net/specs/connect/1.0/issuer", "href": "https://sso.securenexus.net/application/o/tailscale/"}]}` 200

    # Fallback for other resources
    respond `{"error": "resource not found"}` 404
  }
}